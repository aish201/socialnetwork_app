<div class="container profile-container mt-4 mb-5">

  <!-- Profile Header (Instagram style) -->
  <div class="card border-0 shadow-sm rounded-4 p-4 profile-header">
    <div class="d-flex align-items-center flex-wrap gap-4">

      <!-- Profile Picture with Upload -->
      <div class="position-relative">
        <img [src]="profile?.profilePicUrl + '?t=' + timeStamp"
             class="profile-pic shadow-sm"
             alt="Profile Picture">
        <div class="upload-btn">
          <i class="bi bi-camera-fill"></i>
          <input type="file" class="form-control-file" (change)="onProfilePicSelected($event)">
        </div>
      </div>

      <!-- User Info -->
      <div class="flex-grow-1">
        <h4 class="fw-semibold text-capitalize mb-2">{{ profile?.username }}</h4>

        <!-- Bio Section -->
        <div *ngIf="!editMode">
          <p class="bio-text mb-2 text-muted">{{ bio || 'Add a short bio about yourself' }}</p>
          <button class="btn btn-link p-0 bio-edit-btn text-decoration-none fw-semibold" (click)="enableEdit()">
            Add bio
          </button>
        </div>

        <div *ngIf="editMode" class="edit-bio mt-2">
          <textarea [(ngModel)]="bio"
                    class="form-control border-0 shadow-sm rounded-3 p-3"
                    rows="2"
                    maxlength="150"
                    placeholder="Write something about yourself..."></textarea>
          <div class="d-flex justify-content-start mt-2 gap-2">
            <button class="btn btn-sm btn-primary px-3" (click)="saveBio()">Save</button>
            <button class="btn btn-sm btn-outline-secondary px-3" (click)="cancelEdit()">Cancel</button>
          </div>
        </div>

        <!-- Change Photo Button -->
        <button class="btn btn-sm btn-outline-primary mt-3" (click)="uploadProfilePic()">
          Change Photo
        </button>
      </div>
    </div>
  </div>




  <!-- Create Post -->
  <div class="card create-post-card shadow-sm mb-4 border-0 p-3 rounded-4">
    <div class="d-flex align-items-start gap-3">
      <img [src]="profile?.profilePicUrl + '?t=' + timeStamp"
           class="rounded-circle border profile-mini"
           width="50" height="50">
      <div class="flex-grow-1">
        <textarea [(ngModel)]="newPost.content"
                  class="form-control border-0 shadow-none"
                  rows="3"
                  placeholder="What's on your mind?"></textarea>
        <div class="d-flex align-items-center justify-content-between mt-3">
          <label class="custom-file-upload mb-0">
            <i class="bi bi-image"></i> Add Photo
            <input type="file" (change)="onPostImageSelected($event)">
          </label>
          <button class="btn btn-primary rounded-pill px-4"
                  (click)="createPost()"
                  [disabled]="!newPost.content?.trim()">Post</button>
        </div>
      </div>
    </div>
  </div>
</div>

<h5 class="fw-bold mb-3 text-center">Your Posts</h5>

<div class="posts-grid">
  <div *ngFor="let post of myPosts" class="post-card shadow-sm border-0">
    <div class="card-body p-3">

      <div class="d-flex align-items-center mb-3">
        <img [src]="profile?.profilePicUrl + '?t=' + timeStamp"
             alt="Profile"
             class="rounded-circle me-2"
             width="40" height="40">
        <div>
          <h6 class="mb-0 fw-semibold">{{ post.user?.username || profile?.username }}</h6>
          <small class="text-muted">{{ post.createdAt | date:'medium' }}</small>
        </div>
      </div>

      <!-- Image or Text-only display -->
      <div class="post-image-container mb-3" *ngIf="post.imageUrl; else textOnlyPost">
        <img [src]="post.imageUrl" alt="Post Image" class="post-image img-fluid rounded-3">
      </div>

      <!-- Text-only Post Template -->
      <ng-template #textOnlyPost>
        <div class="text-post d-flex align-items-center justify-content-center text-center rounded-3 p-3">
          <p class="mb-0 fw-medium text-dark">{{ post.content }}</p>
        </div>
      </ng-template>

      <div class="d-flex justify-content-between align-items-center mt-3">
        <div class="like-section">
          <i class="bi bi-heart-fill text-danger"></i>
          <span class="fw-semibold ms-1">{{ post.likes }}</span>
        </div>
        <button class="btn btn-sm btn-outline-danger" (click)="deletePost(post.id!)">
          <i class="bi bi-trash"></i> Delete
        </button>
      </div>

    </div>
  </div>
</div>
